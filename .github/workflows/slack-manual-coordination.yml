name: Manual Slack Coordination

on:
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest

    steps:
      - name: Post Slack message
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          TZ: Europe/Copenhagen
        run: |
          WEEK=$(date +"%V")
          MESSAGE="<!here> week ${WEEK} coordination"

          # Step 1: Post the message
          RESPONSE=$(curl -s -X POST https://slack.com/api/chat.postMessage \
            -H "Authorization: Bearer $SLACK_BOT_TOKEN" \
            -H "Content-Type: application/json" \
            -d "{
              \"channel\": \"#team-drupal\",
              \"text\": \"$MESSAGE\"
            }")

          # Extract the timestamp (ts) from the response
          TS=$(echo "$RESPONSE" | jq -r '.ts')

          # Step 2: Add reactions (clickable emojis)
          for EMOJI in monday tuesday wednesday2 thursday friday2; do
            curl -s -X POST https://slack.com/api/reactions.add \
              -H "Authorization: Bearer $SLACK_BOT_TOKEN" \
              -H "Content-Type: application/json" \
              -d "{
                \"channel\": \"#team-drupal\",
                \"name\": \"$EMOJI\",
                \"timestamp\": \"$TS\"
              }"
          done